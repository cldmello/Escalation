{% extends 'base.html' %}

{% block header %}

<script language="javascript">

  function deleteConfSubmit(form) {

  if (confirm("Careful...Are you sure you want to delete  submissions?")) {
  form.submit();
 }
}

function checkAll(ele) {
     var checkboxes = document.getElementsByTagName('input');
     if (ele.checked) {
         for (var i = 0; i < checkboxes.length; i++) {
             if (checkboxes[i].type == 'checkbox'  && checkboxes[i].name == 'download') {
                 checkboxes[i].checked = true;
             }
         }
     } else {
         for (var i = 0; i < checkboxes.length; i++) {
             console.log(i)
             if (checkboxes[i].type == 'checkbox'  && checkboxes[i].name == 'download') {
                 checkboxes[i].checked = false;
             }
         }
     }

                             }

function checkAllModels(ele) {
     var checkboxes = document.getElementsByTagName('input');
     if (ele.checked) {
         for (var i = 0; i < checkboxes.length; i++) {
             if (checkboxes[i].type == 'checkbox' && checkboxes[i].name == 'policy_download') {
                 checkboxes[i].checked = true;
             }
         }
     } else {
         for (var i = 0; i < checkboxes.length; i++) {
             console.log(i)
             if (checkboxes[i].type == 'checkbox' && checkboxes[i].name == 'policy_download') {
                 checkboxes[i].checked = false;
             }
         }
     }

      }
                             
</script>
{% endblock %}


{% block content %}
<h2>Training Data</h2>

<div style="max-width:1000px;">
<form method="post">
  <label for="training_crank">Download the training data csv corresponding to the checked crank.</label>
  <table  id="training_dataset_table" class="compact hover order-column row-border" style="width:100%">
  <thead>
  <tr>
    <th></th>
    <th>Crank</th>
    <th>Versioned Repo Hash</th>
    <th>Upload Time</th>
    <th>Number of rows</th>
  </tr>
  </thead>
  <tbody>
  {% for training_crank in training_data_available_to_download %}
    <tr>
      <td> <input type="radio" name="download_training_crank" value="{{ training_crank['file_path'] }}" checked> </td>
      <td> {{ training_crank['crank'] }} </td>
      <td> {{ training_crank['githash'] }} </td>
      <td> {{ training_crank['created'].strftime('%m-%d-%y %H:%M') }} </td>
      <td> {{ training_crank['num_training_rows'] }} </td>
    </tr>
  {% endfor %}
  </tbody>
  </table>


  <!--<select name="training_crank"   onchange="this.form.submit()">-->
    <!--<option value="blank">None</option>-->
    <!--{% for training_crank in training_data_available_to_download %}-->
    <!--<option value="{{ crank_filename }}" {% if crank == training_crank %} selected {% endif %} >{{ crank }}</option>-->
    <!--{% endfor %}-->
  <!--</select>-->
  <!--<input type="hidden" value="{{ training_crank }}" name="num_runs">-->
  <div>
    <input type="submit" value="Download training data" name="submit">
  </div>
</form>

<h2>Submissions</h2>

<div style="max-width:1000px;">
<form method="post">
  <label for="crank">Select specific crank</label>
  <select name="crank"   onchange="this.form.submit()">
    <option value="all">All</option>
    {% for crank in cranks %}
    <option value="{{ crank }}" {% if crank == curr_crank %} selected {% endif %} >{{ crank }}</option>
    {% endfor %}
  </select>
</form>


<form method="post">
  <table  id="submission_table" class="compact hover order-column row-border" style="width:100%">
  <thead>
  <tr>
    <th><input type="checkbox" onchange="checkAll(this)" name="chk[]" checked/> </th>
    <th>Crank</th>    
    <th>User Name</th>
    <th>Name</th>
    <th>Versioned Repo Hash</th>        
    <th>Timestamp</th>                
    <th>Notes</th>
  </tr>
  </thead>
  <tbody>
{% for sub in submissions %}
  <tr>
    <td> <input type="checkbox" name="download" value="{{ sub['id'] }}" checked> </td>
    <td> {{ sub['crank'] }} </td>  
    <td> {{ sub['username'] }} </td>
    <td> {{ sub['expname'] }} </td>
    <td> {{ sub['githash'] }} </td>    
    <td> {{ sub['created'].strftime('%m-%d-%y %H:%M') }} </td>
    <td> {{ sub['notes'][:50] + "..." }} </td>
  </tr>
  {% endfor %}
  </tbody>
  </table>

  <script type="text/javascript">
	
$(document).ready(function() {
$('#submission_table').DataTable( {
        "order": [[ 5, "desc" ]],
"columnDefs": [
    { "orderable": false, "targets": 0 }
  ]
}
);
} );
	</script>
  
  <input type="hidden" value="{{ curr_crank }}" name="crank">
  <div>        
    <input type="submit" value="Download files" name="submit">
    <div style="float:right">
      <input type="submit" value="Delete file" onClick="deleteConfSubmit(this.form);" name="submit" style="color:red">      
      <label for="adminkey" style="display:flex">Admin code required for deletion</label>  
      <input type="text" name="adminkey">
    </div>
  </div>
</form>
</div>
<a name="policy"></a>  
<h2>Policy-Guided Download</h2>
<form method="post" action="{{ url_for('view.view') }}#policy" >
  <label for="policy_crank">Select specific crank</label>
  <select name="policy_crank"  onchange="this.form.submit()">
    {% for crank in cranks %}
    <option value="{{ crank }}" {% if crank == policy_crank %} selected {% endif %} >{{ crank }} </option>
    {% endfor %}
  </select>
  
<label for="cranksize">Number of samples</label>
<input type="text" name="cranksize" required style="width:80px">
  <table id="model_table" width="390">
    <thead>
      <col width="10">
      <col width="140">
      <col width="240">            
      <tr>
        <th><input type="checkbox" onchange="checkAllModels(this)" name="chk[]" /> </th>
        <th>Model</th>
        <th>Created</th>        
      </tr>
    </thead>
    <tbody>
    {% for model in models %}
    <tr>
      <td> <input type="checkbox" name="policy_download" value="{{model['id']}}" {% if model['expname'] in defaults %} checked {% endif %}></td>
      <td>{{model['expname']}} </td>
      <td>{{model['created']}} </td>      
    </tr>
    {% endfor %}
    </tbody>
  </table>
  <input type="submit" value="Download Submissions" name="policy_submit">
</form>

{% endblock %}
